<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å®¶åº­å…¬ä¼šï¼šV7.0 äº‘ç«¯ç‰ˆ</title>

    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Russo+One&display=swap" rel="stylesheet">

    <style>
        /* ================= æ ¸å¿ƒå®‡å®™è®¾å®š ================= */
        :root {
            --neon-blue: #00f3ff;
            --neon-purple: #bc13fe;
            --neon-red: #ff0055;
            --neon-gold: #ffe600;
            --bg-dark: #050510;
            --glass: rgba(10, 20, 40, 0.75);
            --theme-color: var(--neon-blue);
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Orbitron', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background-color: var(--bg-dark);
            color: #fff;
            margin: 0;
            padding: 15px;
            padding-bottom: 100px;
            overflow-x: hidden;
            min-height: 100vh;
            background-image: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
        }

        /* åŠ¨æ€æ˜Ÿç©ºç½‘æ ¼èƒŒæ™¯ */
        .bg-animation {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            background:
                radial-gradient(circle at 50% 0%, #1a1a3a 0%, transparent 70%),
                linear-gradient(transparent 0%, var(--bg-dark) 100%);
            perspective: 1000px;
        }
        .grid-floor {
            position: absolute;
            bottom: -30%;
            left: -50%;
            width: 200%;
            height: 100%;
            background-image:
                linear-gradient(var(--theme-color) 1px, transparent 1px),
                linear-gradient(90deg, var(--theme-color) 1px, transparent 1px);
            background-size: 40px 40px;
            background-position: center bottom;
            transform: rotateX(60deg);
            opacity: 0.15;
            animation: gridMove 20s linear infinite;
            mask-image: linear-gradient(to top, rgba(0,0,0,1) 0%, rgba(0,0,0,0) 60%);
        }

        @keyframes gridMove { 0% { transform: rotateX(60deg) translateY(0); } 100% { transform: rotateX(60deg) translateY(40px); } }

        /* é¡¶éƒ¨å·¥å…·æ  */
        .top-bar {
            display: flex;
            justify-content: space-between; /* æ”¹ä¸ºä¸¤ç«¯å¯¹é½ */
            align-items: center;
            margin-bottom: 10px;
        }
        .status-indicator {
            font-size: 0.7rem;
            color: #888;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .status-dot {
            width: 8px; height: 8px; border-radius: 50%; background: #555;
            box-shadow: 0 0 5px #555;
        }
        .status-dot.online { background: #0f0; box-shadow: 0 0 8px #0f0; }
        .status-dot.syncing { background: #ff0; box-shadow: 0 0 8px #ff0; animation: blink 1s infinite; }

        @keyframes blink { 50% { opacity: 0.5; } }

        .rules-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--theme-color);
            color: var(--theme-color);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            display: flex; align-items: center; gap: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        /* HUD é¢æ¿ */
        .hud-panel {
            border: 1px solid var(--theme-color);
            background: var(--glass);
            border-radius: 10px;
            padding: 15px;
            position: relative;
            box-shadow: 0 0 15px var(--theme-color), inset 0 0 20px rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            margin-bottom: 25px;
            overflow: hidden;
        }
        .hud-corner { position: absolute; width: 10px; height: 10px; border: 2px solid var(--theme-color); }
        .tl { top: -1px; left: -1px; border-right: 0; border-bottom: 0; }
        .tr { top: -1px; right: -1px; border-left: 0; border-bottom: 0; }
        .bl { bottom: -1px; left: -1px; border-right: 0; border-top: 0; }
        .br { bottom: -1px; right: -1px; border-left: 0; border-top: 0; }

        .profile-row { display: flex; align-items: center; gap: 15px; z-index: 2; position: relative; }

        .avatar-box {
            width: 70px; height: 70px; border-radius: 50%;
            border: 2px solid var(--theme-color);
            background: rgba(0,0,0,0.5);
            display: flex; justify-content: center; align-items: center;
            font-size: 2.5rem; position: relative;
            box-shadow: 0 0 10px var(--theme-color);
        }
        .avatar-ring {
            position: absolute; top: -5px; left: -5px; right: -5px; bottom: -5px;
            border: 1px dashed var(--theme-color); border-radius: 50%;
            animation: spin 10s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        .stats-col { flex: 1; }
        .hero-name { font-family: 'Russo One', 'PingFang SC', sans-serif; font-size: 1.1rem; text-transform: uppercase; letter-spacing: 1px; text-shadow: 0 0 5px var(--theme-color); }
        .hero-class { font-size: 0.7rem; color: #aaa; letter-spacing: 1px; margin-bottom: 5px; }

        .xp-wrapper { margin-top: 5px; position: relative; }
        .xp-bg { background: #111; height: 8px; border: 1px solid #333; transform: skewX(-20deg); }
        .xp-fill { height: 100%; background: var(--theme-color); width: 0%; box-shadow: 0 0 8px var(--theme-color); transition: width 0.5s ease; }
        .xp-txt { font-size: 0.6rem; position: absolute; right: 0; top: -14px; color: var(--theme-color); font-weight: bold; text-shadow: 0 0 2px #000;}

        .coin-hud { text-align: right; border-left: 1px solid rgba(255,255,255,0.1); padding-left: 15px; }
        .coin-val { font-size: 2rem; font-weight: 900; color: var(--neon-gold); text-shadow: 0 0 10px var(--neon-gold); font-family: 'Russo One', sans-serif; }
        .coin-lbl { font-size: 0.6rem; color: #fff; opacity: 0.5; letter-spacing: 2px; }

        /* åˆ‡æ¢æŒ‰é’® */
        .switch-deck { display: flex; gap: 15px; margin-bottom: 20px; }
        .cyber-btn {
            flex: 1; background: rgba(0,0,0,0.6); border: 1px solid #333; color: #555; padding: 12px;
            font-family: 'Orbitron', 'PingFang SC', sans-serif; font-weight: bold; text-transform: uppercase;
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
            transition: all 0.3s; position: relative;
        }
        .cyber-btn.active {
            background: rgba(0, 243, 255, 0.1); border-color: var(--theme-color); color: var(--theme-color);
            text-shadow: 0 0 5px var(--theme-color); box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }
        .cyber-btn.active::before { content: ''; position: absolute; left: 0; bottom: 0; width: 10px; height: 10px; background: var(--theme-color); }

        /* å¯¼èˆª */
        .nav-deck { display: flex; justify-content: space-between; border-bottom: 2px solid rgba(255,255,255,0.1); margin-bottom: 20px; padding-bottom: 5px; }
        .nav-item { color: #666; font-size: 0.9rem; padding: 8px 15px; cursor: pointer; transition: all 0.3s; position: relative; }
        .nav-item.active { color: #fff; text-shadow: 0 0 8px #fff; }
        .nav-item.active::after { content: ''; position: absolute; bottom: -7px; left: 0; width: 100%; height: 2px; background: var(--theme-color); box-shadow: 0 -2px 5px var(--theme-color); }

        /* ç½‘æ ¼å¸ƒå±€ */
        .grid-area { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }

        .holo-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(0,0,0,0.4) 100%);
            border: 1px solid rgba(255,255,255,0.1); padding: 15px; position: relative;
            overflow: hidden; transition: transform 0.2s, box-shadow 0.3s, border-color 0.3s; cursor: pointer;
            display: flex; flex-direction: column; align-items: center; text-align: center; min-height: 150px;
        }
        .holo-card:hover { box-shadow: 0 0 15px var(--theme-color), inset 0 0 10px rgba(0,0,0,0.5); border-color: var(--theme-color); transform: translateY(-2px) scale(1.02); }

        @keyframes successGlow {
            0% { box-shadow: 0 0 0px var(--theme-color); border-color: var(--theme-color); }
            50% { box-shadow: 0 0 20px var(--neon-gold), inset 0 0 15px var(--neon-gold); border-color: var(--neon-gold); }
            100% { box-shadow: 0 0 0px var(--theme-color); border-color: rgba(255,255,255,0.1); }
        }
        .holo-card.success-flash { animation: successGlow 0.5s ease-out; }

        .holo-icon { font-size: 2.5rem; margin-bottom: 10px; filter: drop-shadow(0 0 5px rgba(255,255,255,0.3)); }
        .holo-title { font-size: 0.9rem; font-weight: bold; color: #fff; margin-bottom: 5px; line-height: 1.2; }
        .holo-desc { font-size: 0.6rem; color: #888; margin-bottom: 10px; flex-grow: 1; }

        .reward-tag {
            background: rgba(0,0,0,0.6); border: 1px solid var(--theme-color); padding: 4px 10px;
            font-size: 0.8rem; color: var(--theme-color); font-weight: bold; box-shadow: 0 0 5px var(--theme-color);
        }
        .holo-card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 2px; background: linear-gradient(90deg, transparent, var(--theme-color), transparent); }
        .holo-card:active { transform: scale(0.95); border-color: var(--theme-color); }
        .cost-tag { border-color: var(--neon-red); color: var(--neon-red); box-shadow: 0 0 5px var(--neon-red); }
        .shop-border { border: 1px dashed var(--neon-gold); }
        .footer { text-align: center; margin-top: 40px; opacity: 0.5; font-size: 0.7rem; letter-spacing: 2px; }

        /* æ¨¡æ€æ¡† */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); z-index: 1000;
            display: none; justify-content: center; align-items: center;
        }
        .modal-content {
            background: var(--bg-dark); border: 2px solid var(--theme-color); border-radius: 15px;
            width: 90%; max-width: 500px; max-height: 80vh; overflow-y: auto; padding: 20px;
            box-shadow: 0 0 30px var(--theme-color); position: relative; color: #ddd; font-size: 0.9rem; line-height: 1.6;
        }
        .modal-content h2 { color: var(--theme-color); margin-top: 0; text-align: center; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .modal-content h3 { color: #fff; margin-top: 20px; margin-bottom: 10px; border-left: 3px solid var(--theme-color); padding-left: 10px; }
        .level-table { width: 100%; border-collapse: collapse; margin-bottom: 15px; font-size: 0.8rem; }
        .level-table th, .level-table td { border: 1px solid #333; padding: 8px; text-align: left; }
        .level-table th { background: rgba(255,255,255,0.1); color: var(--theme-color); }
        .role-header { color: var(--neon-blue); margin-top: 10px; margin-bottom: 5px; font-weight: bold; }
        .role-header.warrior { color: var(--neon-red); }
        .close-modal-btn {
            display: block; width: 100%; padding: 12px; background: var(--theme-color); color: #000; font-weight: bold;
            border: none; border-radius: 10px; margin-top: 20px; cursor: pointer; font-family: 'Orbitron', sans-serif;
        }
        .close-modal-btn:active { opacity: 0.8; }
    </style>
</head>
<body>

    <div class="bg-animation"><div class="grid-floor"></div></div>

    <div class="top-bar">
        <div class="status-indicator">
            <div class="status-dot" id="net-status"></div>
            <span id="net-text">æ£€æµ‹ä¸­...</span>
        </div>
        <div class="rules-btn" onclick="openRules()">ğŸ“œ ç©å®¶æŒ‡å—</div>
    </div>

    <div class="switch-deck">
        <div id="btn-mage" class="cyber-btn active" onclick="handleRoleSwitch('mage')">ğŸ”¹ å¥¥æœ¯å¤§æ³•å¸ˆ (æ–½å¸¸é’°)</div>
        <div id="btn-warrior" class="cyber-btn" onclick="handleRoleSwitch('warrior')">ğŸ”¸ è£è€€ç‹‚æˆ˜å£« (æ–½å¸¸æ¾)</div>
    </div>

    <div class="hud-panel">
        <div class="hud-corner tl"></div><div class="hud-corner tr"></div><div class="hud-corner bl"></div><div class="hud-corner br"></div>
        <div class="profile-row">
            <div class="avatar-box"><span id="ui-avatar">ğŸ§™â€â™‚ï¸</span><div class="avatar-ring"></div></div>
            <div class="stats-col">
                <div class="hero-name" id="ui-name">Loading...</div>
                <div class="hero-class" id="ui-title">...</div>
                <div class="xp-wrapper">
                    <div class="xp-txt" id="ui-xp-txt">0 / 0 XP</div>
                    <div class="xp-bg"><div class="xp-fill" id="ui-xp-bar"></div></div>
                </div>
            </div>
            <div class="coin-hud"><div class="coin-val" id="ui-gold">0</div><div class="coin-lbl">å…¬ä¼šé‡‘å¸</div></div>
        </div>
    </div>

    <div class="nav-deck">
        <div class="nav-item active" id="tab-daily" onclick="handleTabSwitch('daily')">æ—¥å¸¸ä»»åŠ¡</div>
        <div class="nav-item" id="tab-weekend" onclick="handleTabSwitch('weekend')">å‘¨æœ«æŒ‘æˆ˜</div>
        <div class="nav-item" id="tab-shop" onclick="handleTabSwitch('shop')">ç§¯åˆ†å†›æ¢°åº“</div>
    </div>

    <div id="content-area" class="grid-area"></div>

    <div id="rules-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>ğŸ“œ è‹±é›„å…¬ä¼šç©å®¶æŒ‡å—</h2>
            <h3>1. æ™‹å‡é˜¶æ¢¯ (Level Up)</h3>
            <p>ç§¯ç´¯ç»éªŒå€¼ (XP) æå‡ç­‰çº§ï¼Œè·å¾—æ›´å¸…æ°”çš„å¤´è¡”ï¼</p>
            <div id="level-table-container"></div>
            <h3>2. æ ¸å¿ƒæ³•åˆ™</h3>
            <ul>
                <li><strong>G (é‡‘å¸)</strong>ï¼šä¸¥ç¦ç§è‡ªæ“ä½œï¼Œå¿…é¡»ç”±çˆ¶æ¯è¾“å…¥å¯†ç æˆæƒï¼</li>
                <li><strong>äº‘ç«¯åŒæ­¥</strong>ï¼šæ•°æ®ä¼šå®æ—¶ä¿å­˜åœ¨æœåŠ¡å™¨ï¼Œçˆ¸çˆ¸åœ¨å…¬å¸ä¹Ÿèƒ½çœ‹åˆ°ï¼</li>
            </ul>
            <h3>3. å¹¸è¿è¡¥ç»™ç®± (æ¦‚ç‡)</h3>
            <ul>
                <li>ğŸ’¨ 50%ï¼šç©ºç®±å­</li><li>ğŸ’° 30%ï¼šè¿”è¿˜ 3 é‡‘å¸</li><li>ğŸ¥¤ 15%ï¼šé¥®æ–™ä¸€ç“¶</li><li>ğŸ§§ 5%ï¼šç°é‡‘çº¢åŒ… 5å…ƒ</li>
            </ul>
            <button class="close-modal-btn" onclick="closeRules()">æˆ‘çŸ¥é“äº†</button>
        </div>
    </div>

    <div class="footer">ç³»ç»Ÿ V7.0 // äº‘ç«¯åŒæ­¥ç‰ˆ<br><a href="#" onclick="resetData()" style="color:#555; text-decoration:none">[ é‡ç½®ç³»ç»Ÿ ]</a></div>

    <script>
        // ============================================================
        // âš ï¸âš ï¸âš ï¸ è¯·åœ¨æ­¤å¤„å¡«å…¥ç¬¬ä¸€æ­¥éƒ¨ç½² Worker è·å¾—çš„ç½‘å€ âš ï¸âš ï¸âš ï¸
        // ä¾‹å¦‚: const API_URL = "https://family-api.zhangsan.workers.dev";
        // ============================================================

        const API_URL = "https://family-api.shiyunpupu.workers.dev/";

        // ============================================================

        const PARENT_PIN = "888999";

        // æ¸¸æˆé…ç½® (ä¿æŒ V6.4 çš„æœ€æ–°é…ç½®)
        const gameData = {
            mage: {
                name: "å¥¥æœ¯å¤§æ³•å¸ˆ (æ–½å¸¸é’°)", avatar: "ğŸ§™â€â™‚ï¸", color: "#00f3ff",
                levels: [{ xp: 0, title: "Lv.1 è§ä¹ é­”æ³•å­¦å¾’" }, { xp: 100, title: "Lv.2 ç§˜æ³•æ“æ§è€…" }, { xp: 300, title: "Lv.3 çš‡å®¶é¦–å¸­æ³•å¸ˆ" }, { xp: 600, title: "Lv.MAX å…¨çŸ¥å…¨èƒ½è´¤è€…" }],
                dailyTasks: [
                    { name: "ä¸ªäººæ¸…æ´", icon: "ğŸ§¼", gold: 1, xp: 3, desc: "æ—©æ™šä¸»åŠ¨æ´—è„¸ã€åˆ·ç‰™ã€è‡ªç†" },
                    { name: "æ™¨é—´åè®®: æ—©èµ·", icon: "â°", gold: 1, xp: 5, desc: "7:10å‰å®Œæˆå¯åŠ¨" },
                    { name: "è£…å¤‡å°±ç»ª", icon: "ğŸ‘š", gold: 1, xp: 3, desc: "æ•´ç†æ˜æ—¥è¡£ç‰©ä¸ç‰©å“" },
                    { name: "ç©ºé—´æ•´ç†", icon: "ğŸ§¹", gold: 1, xp: 5, desc: "æ•´ç†ä¹¦æ¡Œæˆ–åºŠé“º" },
                    { name: "æ•°æ®å½•å…¥: ä½œä¸š", icon: "ğŸ’ ", gold: 3, xp: 10, desc: "å‡†ç¡®ç‡95%+" },
                    { name: "å­¦ä¹ æ¨¡å—å‡çº§", icon: "ğŸ’¡", gold: 2, xp: 10, desc: "å®Œæˆä½œä¸šä»¥å¤–çš„å­¦ä¹ èµ„æ–™" },
                    { name: "æƒ…æŠ¥æ±‡æŠ¥", icon: "ğŸ“°", gold: 2, xp: 5, desc: "é˜…è¯»æ–°é—»/ç§‘æ™®å¹¶å‘å®¶äººåˆ†äº«" },
                    { name: "åŸºåœ°ç»´æŠ¤: å®¶åŠ¡", icon: "ğŸ”§", gold: 2, xp: 5, desc: "æ´—ç¢—/å€’åƒåœ¾ç­‰ä¸»åŠ¨å®¶åŠ¡" },
                    { name: "ä½“èƒ½è®­ç»ƒ", icon: "ğŸƒ", gold: 2, xp: 5, desc: "è·³ç»³/è·‘æ­¥ç­‰è¿åŠ¨30åˆ†é’Ÿ" },
                    { name: "è§†åŠ›æŠ¤ç›¾", icon: "ğŸ‘€", gold: 1, xp: 3, desc: "è®¤çœŸåšçœ¼ä¿å¥æ“æˆ–è¿œçœº" },
                    { name: "ç»´ç”Ÿç´ è¡¥ç»™", icon: "ğŸ", gold: 1, xp: 3, desc: "ä¸»åŠ¨åƒæ°´æœ" }
                ],
                weekendTasks: [
                    { name: "æˆ·å¤–æ¢ç´¢", icon: "ğŸš€", gold: 10, xp: 20, desc: "å¤–éƒ¨ç¯å¢ƒæ´»åŠ¨2å°æ—¶+" },
                    { name: "æ·±åº¦æ¸…æ´", icon: "ğŸ§¼", gold: 15, xp: 30, desc: "å¤§æ‰«é™¤æŸä¸€æŒ‡å®šåŒºåŸŸ" },
                    { name: "ä»»åŠ¡æ¸…é›¶", icon: "âš¡", gold: 5, xp: 10, desc: "å‘¨å…­ä¸­åˆå‰å®Œæˆæ‰€æœ‰æ—¥å¸¸ä»»åŠ¡" },
                    { name: "åŒç›Ÿå»ºç«‹: ç¤¾äº¤", icon: "ğŸ¤", gold: 8, xp: 15, desc: "æ‰¾æœ‹å‹æˆ–åŒå­¦ä¸€èµ·ç©" },
                    { name: "çƒ¹é¥ªè¡¥ç»™", icon: "ğŸ‘¨â€ğŸ³", gold: 12, xp: 25, desc: "ååŠ©åˆ¶ä½œä¸€é¡¿é¥­èœ" },
                    { name: "å­¦é•¿äº’åŠ©", icon: "ğŸ§‘â€ğŸ¤â€ğŸ§‘", gold: 15, xp: 30, desc: "ä¸»åŠ¨å¸®åŠ©å¼Ÿå¼Ÿå­¦ä¹ æˆ–è§£å†³é—®é¢˜" },
                    { name: "è‰ºæœ¯åˆ›ä½œ", icon: "ğŸ¨", gold: 10, xp: 20, desc: "å®Œæˆä¸€å¹…ç”»ä½œæˆ–æ‰‹å·¥" },
                    { name: "ä¸ªäººåæ€", icon: "ğŸ§ ", gold: 8, xp: 15, desc: "å†™ä¸‹æœ¬å‘¨3ä¸ªè¿›æ­¥ä¸3ä¸ªå¾…æ”¹è¿›ç‚¹" },
                    { name: "æ·±åº¦é˜…è¯»", icon: "ğŸ“š", gold: 10, xp: 20, desc: "é˜…è¯»éè™šæ„ç±»ä¹¦ç±1å°æ—¶å¹¶åšç¬”è®°" },
                    { name: "ä¼‘æ¯ç»´æŠ¤", icon: "ğŸ“–", gold: 8, xp: 15, desc: "åˆä¼‘æˆ–å®‰é™ç‹¬å¤„1å°æ—¶" }
                ]
            },
            warrior: {
                name: "è£è€€ç‹‚æˆ˜å£« (æ–½å¸¸æ¾)", avatar: "âš”ï¸", color: "#ff0055",
                levels: [{ xp: 0, title: "Lv.1 è®­ç»ƒè¥æ–°å…µ" }, { xp: 100, title: "Lv.2 å¸å›½é’¢é“å«å£«" }, { xp: 300, title: "Lv.3 å± é¾™å‹‡å£«" }, { xp: 600, title: "Lv.MAX é“¶æ²³æˆ˜ç¥" }],
                dailyTasks: [
                    { name: "ä¸ªäººæ¸…æ´", icon: "ğŸ§¼", gold: 1, xp: 3, desc: "æ—©æ™šä¸»åŠ¨æ´—è„¸ã€åˆ·ç‰™ã€è‡ªç†" },
                    { name: "æ™¨é—´åè®®: æ—©èµ·", icon: "â°", gold: 1, xp: 5, desc: "7:10å‰å®Œæˆå¯åŠ¨" },
                    { name: "ä¼‘çœ æ¨¡å¼", icon: "ğŸŒ™", gold: 1, xp: 5, desc: "21:30å‰å‡†æ—¶å…¥ç¡" },
                    { name: "æ•´ç†èƒŒåŒ…", icon: "ğŸ’", gold: 1, xp: 3, desc: "æ£€æŸ¥å­¦ä¹ ç‰©å“æ˜¯å¦é½å…¨" },
                    { name: "è”¬èœæ‘„å…¥", icon: "ğŸ¥¦", gold: 1, xp: 3, desc: "ä¸»åŠ¨åƒå®ŒæŒ‡å®šè”¬èœä»½é‡" },
                    { name: "å®šåŠ›åŠ›åœº", icon: "ğŸ›¡ï¸", gold: 2, xp: 5, desc: "é™å20åˆ†é’Ÿå®Œæˆä½œä¸š" },
                    { name: "å‡†ç¡®ç‡æ ¡éªŒ", icon: "âœ…", gold: 3, xp: 10, desc: "ä½œä¸šæ­£ç¡®ç‡è¾¾90%+" },
                    { name: "æƒ…æŠ¥æ”¶é›†: é˜…è¯»", icon: "ğŸ’¾", gold: 3, xp: 10, desc: "é˜…è¯»å¹¶æ±‡æŠ¥æ•…äº‹å†…å®¹" },
                    { name: "æƒ…ç»ªæ§åˆ¶", icon: "ğŸ§˜", gold: 2, xp: 5, desc: "é‡åˆ°æŒ«æŠ˜ä¸å“­é—¹ã€ä¸å‘è„¾æ°”" },
                    { name: "å€¾å¬æŒ‡ä»¤", icon: "ğŸ‘‚", gold: 2, xp: 5, desc: "å¬å®Œçˆ¶æ¯æŒ‡ä»¤å†è¡ŒåŠ¨" },
                    { name: "è¿åŠ¨æ¨¡ç»„", icon: "âš½", gold: 2, xp: 5, desc: "æˆ·å¤–è·‘åŠ¨æˆ–è¿åŠ¨30åˆ†é’Ÿ" }
                ],
                weekendTasks: [
                    { name: "é—ªç”µæˆ˜(å‘¨äº”)", icon: "âš¡", gold: 15, xp: 30, desc: "å‘¨äº”æ™šæ¸…ç©ºæ‰€æœ‰å‘¨æœ«ä½œä¸š" },
                    { name: "æˆ˜åœºæ¸…æ‰«", icon: "ğŸ§¹", gold: 8, xp: 15, desc: "å‘¨å…­ä¸­åˆå‰å®Œæˆæ‰€æœ‰å‘¨æœ«ä½œä¸š" },
                    { name: "å±è”½ä¿¡å·", icon: "ğŸ“µ", gold: 5, xp: 10, desc: "ç™½å¤©ä¸æ¥è§¦æ‰‹æœºã€å¹³æ¿" },
                    { name: "ç©å…·å½’ä½", icon: "ğŸ“¦", gold: 15, xp: 30, desc: "ç‹¬ç«‹æ•´ç†å¹¶å½’ä½æ‰€æœ‰ç©å…·" },
                    { name: "å›¢é˜Ÿåˆä½œ", icon: "ğŸ¤", gold: 8, xp: 15, desc: "ä¸å“¥å“¥åˆä½œå®Œæˆä¸€é¡¹å°ä»»åŠ¡" },
                    { name: "å¸®æ‰‹æ¨¡å¼", icon: "ğŸ§º", gold: 12, xp: 25, desc: "ååŠ©çˆ¶æ¯å®Œæˆä¸€é¡¹æŒ‡å®šå®¶åŠ¡" },
                    { name: "è€åŠ›æµ‹è¯•", icon: "ğŸ§±", gold: 10, xp: 20, desc: "è¿ç»­ç©ç§¯æœ¨/ç”»ç”»1å°æ—¶" },
                    { name: "å®‰é™é˜…è¯»", icon: "ğŸ“˜", gold: 10, xp: 20, desc: "å®‰é™é˜…è¯»ç»˜æœ¬æˆ–æ•…äº‹ä¹¦30åˆ†é’Ÿ" },
                    { name: "æ•…äº‹å¤è¿°", icon: "ğŸ¤", gold: 8, xp: 15, desc: "å‘çˆ¶æ¯å®Œæ•´å¤è¿°ä¸€ä¸ªæ•…äº‹" },
                    { name: "ä¼‘æ¯æŒ‡ä»¤", icon: "ğŸ˜´", gold: 5, xp: 10, desc: "æŒ‰æ—¶å®Œæˆåˆç¡æˆ–å®‰é™ä¼‘æ¯" }
                ]
            },
            shop: [
                { name: "å¹¸è¿è¡¥ç»™ç®±", icon: "ğŸ", price: 5, desc: "éšæœºæŠ½å–ç‰©èµ„æˆ–æƒ©ç½š" },
                { name: "å¨±ä¹æ¨¡ç»„30m", icon: "ğŸ®", price: 10, desc: "æ¸¸æˆ/å¹³æ¿æ—¶é—´" },
                { name: "èƒ½é‡æ¶² (é¥®æ–™)", icon: "ğŸ§ª", price: 15, desc: "å¯ä¹/é›ªç¢§/ç‰›å¥¶" },
                { name: "é›¶é£Ÿé…é¢", icon: "ğŸ¬", price: 20, desc: "æŒ‡å®šé›¶é£Ÿä¸€ä»½" },
                { name: "å‘¨æœ«æƒé™", icon: "ğŸ“º", price: 25, desc: "æŒ‡å®šè§‚çœ‹ç”µè§†å¡é€š/ç”µå½±" },
                { name: "ä¸´æ—¶å¢æ´", icon: "ğŸ‘¨â€ğŸ‘§â€ğŸ‘¦", price: 40, desc: "çˆ¶æ¯é™ªä¼´ç©è€30åˆ†é’Ÿ" },
                { name: "é«˜çº§å†›ç²®", icon: "ğŸ”", price: 50, desc: "éº¦å½“åŠ³/è‚¯å¾·åŸº" },
                { name: "é˜²å¾¡åŠ›åœº", icon: "ğŸ›¡ï¸", price: 80, desc: "æŠµæ¶ˆä¸€æ¬¡çˆ¶æ¯çš„æ‰¹è¯„" },
                { name: "ä¼ è¯´è£…å¤‡", icon: "ğŸ‘¾", price: 100, desc: "æŒ‡å®šç©å…·/æ¸¸æˆå¡å¸¦" },
                { name: "ä¸“å±ä»»åŠ¡å¡", icon: "ğŸ‘‘", price: 150, desc: "æŒ‡å®šçˆ¶æ¯å®Œæˆä¸€ä¸ªç®€å•å®¶åŠ¡" }
            ]
        };

        // ================= äº‘ç«¯é€»è¾‘ =================
        let currentRole = 'mage';
        let currentTab = 'daily';
        let userData = { mage: { gold: 0, xp: 0 }, warrior: { gold: 0, xp: 0 } };

        // æ›´æ–°ç½‘ç»œçŠ¶æ€å›¾æ ‡
        function updateStatus(type) {
            const dot = document.getElementById('net-status');
            const txt = document.getElementById('net-text');
            if(type === 'syncing') { dot.className = 'status-dot syncing'; txt.innerText = "åŒæ­¥ä¸­..."; }
            else if(type === 'online') { dot.className = 'status-dot online'; txt.innerText = "äº‘ç«¯å·²è¿æ¥"; }
            else { dot.className = 'status-dot'; txt.innerText = "ç¦»çº¿ / é”™è¯¯"; }
        }

        async function init() {
            updateStatus('syncing');
            // æ£€æŸ¥æ˜¯å¦é…ç½®äº† API URL
            if(API_URL.includes("æ‚¨çš„ç”¨æˆ·å")) {
                alert("âš ï¸ è¯·æ³¨æ„ï¼šæ‚¨è¿˜æ²¡æœ‰åœ¨ä»£ç ä¸­é…ç½® Worker çš„ API é“¾æ¥ï¼\nç›®å‰æ•°æ®å°†æ— æ³•ä¿å­˜ï¼");
                return;
            }

            try {
                const res = await fetch(API_URL);
                if(res.ok) {
                    userData = await res.json();
                    updateStatus('online');
                } else {
                    throw new Error("Fetch failed");
                }
            } catch(e) {
                console.error(e);
                updateStatus('offline');
                alert("æ— æ³•è¿æ¥åˆ°äº‘ç«¯æ•°æ®åº“ï¼Œè¯·æ£€æŸ¥ç½‘ç»œï¼");
            }

            handleRoleSwitch('mage', false);
            generateRuleTables();
        }

        async function saveData() {
            updateStatus('syncing');
            // å…ˆæœ¬åœ°æ›´æ–°UI
            renderHUD();

            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(userData)
                });
                if(res.ok) updateStatus('online');
                else throw new Error("Save failed");
            } catch(e) {
                alert("âš ï¸ æ•°æ®ä¿å­˜å¤±è´¥ï¼è¯·æ£€æŸ¥ç½‘ç»œï¼Œå¦åˆ™åˆ·æ–°åè¿›åº¦ä¼šä¸¢å¤±ï¼");
                updateStatus('offline');
            }
        }

        function authenticate() {
            const input = prompt("ã€æˆæƒéªŒè¯ã€‘\nè¯·å®¶é•¿è¾“å…¥ä»»åŠ¡ç¡®è®¤ç  (å››ä½æ•°å­—):");
            if (input === null || input === "") { alert("æˆæƒå–æ¶ˆã€‚"); return false; }
            if (input === PARENT_PIN) return true;
            else { alert("æˆæƒç é”™è¯¯ï¼"); return false; }
        }

        // ... UI æ¸²æŸ“é€»è¾‘ä¿æŒä¸å˜ ...
        function handleRoleSwitch(role, shouldScroll = true) {
            currentRole = role;
            const config = gameData[role];
            document.documentElement.style.setProperty('--theme-color', config.color);
            document.getElementById('btn-mage').className = role === 'mage' ? 'cyber-btn active' : 'cyber-btn';
            document.getElementById('btn-warrior').className = role === 'warrior' ? 'cyber-btn active' : 'cyber-btn';
            renderHUD(); renderContent();
            if (shouldScroll) window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function handleTabSwitch(tab) {
            currentTab = tab;
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            document.getElementById('tab-' + tab).classList.add('active');
            renderContent(); window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function renderHUD() {
            const data = userData[currentRole];
            const config = gameData[currentRole];
            let levelInfo = config.levels[0];
            let nextXp = config.levels[1] ? config.levels[1].xp : data.xp * 1.5;
            for(let i=0; i<config.levels.length; i++) {
                if(data.xp >= config.levels[i].xp) { levelInfo = config.levels[i]; nextXp = config.levels[i+1] ? config.levels[i+1].xp : config.levels[i].xp * 1.5; }
            }
            document.getElementById('ui-avatar').innerText = config.avatar;
            document.getElementById('ui-name').innerText = config.name;
            document.getElementById('ui-title').innerText = levelInfo.title;
            document.getElementById('ui-gold').innerText = data.gold;
            const xpNeeded = nextXp - data.xp;
            const displayNeeded = xpNeeded > 0 ? xpNeeded : 0;
            const totalRange = nextXp - (config.levels[config.levels.indexOf(levelInfo)]?.xp || 0);
            const currentProgress = data.xp - (config.levels[config.levels.indexOf(levelInfo)]?.xp || 0);
            let percent = (currentProgress / totalRange) * 100; if(percent > 100) percent = 100;
            document.getElementById('ui-xp-bar').style.width = percent + "%";
            document.getElementById('ui-xp-txt').innerText = `${data.xp} / ${nextXp} XP (è¿˜å·® ${displayNeeded})`;
        }

        function renderContent() {
            const container = document.getElementById('content-area'); container.innerHTML = '';
            let list = [];
            if(currentTab === 'daily') list = gameData[currentRole].dailyTasks;
            else if(currentTab === 'weekend') list = gameData[currentRole].weekendTasks;
            else list = gameData.shop;

            list.forEach((item, index) => {
                const isShop = currentTab === 'shop';
                const action = isShop ? `buy(this, '${item.name}', ${item.price})` : `doTask(this, '${item.name}', ${item.gold}, ${item.xp})`;
                const priceTag = isShop ? `<div class="reward-tag cost-tag">-${item.price} G</div>` : `<div class="reward-tag">+${item.gold} G / +${item.xp} XP</div>`;
                container.innerHTML += `<div class="holo-card ${isShop?'shop-border':''}" onclick="${action}" data-index="${index}"><div class="holo-icon">${item.icon}</div><div class="holo-title">${item.name}</div><div class="holo-desc">${item.desc}</div>${priceTag}</div>`;
            });
        }

        function doTask(element, name, gold, xp) {
            if(!confirm(`å®¶é•¿ç¡®è®¤:\nå®Œæˆä»»åŠ¡: [${name}] ?`)) return;
            if (!authenticate()) return;
            element.classList.add('success-flash'); setTimeout(() => element.classList.remove('success-flash'), 500);
            userData[currentRole].gold += gold; userData[currentRole].xp += xp;
            saveData(); // ä¿å­˜åˆ°äº‘ç«¯
            alert(`ä»»åŠ¡å®Œæˆ!\nè·å¾— ${gold} é‡‘å¸, ${xp} ç»éªŒ!`);
        }

        function buy(element, name, price) {
            if(userData[currentRole].gold < price) { alert("âš ï¸ èµ„é‡‘ä¸è¶³!"); return; }
            if(!confirm(`ç¡®è®¤è´­ä¹° [${name}]?`)) return;
            if (!authenticate()) return;
            element.classList.add('success-flash'); setTimeout(() => element.classList.remove('success-flash'), 500);
            userData[currentRole].gold -= price; saveData(); // ä¿å­˜åˆ°äº‘ç«¯
            let msg = `äº¤æ˜“æˆåŠŸ! è¯·æ‰¾çˆ¶æ¯é¢†å–: ${name}`;
            if(name.includes("è¡¥ç»™ç®±")) {
                const rand = Math.random();
                if(rand < 0.5) msg = "ğŸ’¨ ç©ºç®±å­... (è°¢è°¢æƒ é¡¾)";
                else if(rand < 0.8) { msg = "ğŸ’° å°‘é‡å›è¡€ (+3é‡‘å¸)"; userData[currentRole].gold += 3; saveData(); }
                else if(rand < 0.95) msg = "ğŸ¥¤ è·å¾—è¡¥ç»™: é¥®æ–™ä¸€ç“¶!";
                else msg = "ğŸ§§ ä¼ è¯´å¤§å¥–: ç°é‡‘çº¢åŒ… 5å…ƒ!!!";
            }
            setTimeout(() => alert(msg), 300);
        }

        function resetData() {
            if (!authenticate()) return;
            if(confirm("âš ï¸ è­¦å‘Š: å°†æ¸…é™¤æ‰€æœ‰ç³»ç»Ÿæ•°æ®! ç¡®è®¤æ¸…é™¤å—?")) {
                userData = { mage: { gold: 0, xp: 0 }, warrior: { gold: 0, xp: 0 } };
                saveData(); // ä¿å­˜åˆ°äº‘ç«¯
                alert("ç³»ç»Ÿå·²é‡ç½®ï¼Œæ•°æ®å½’é›¶ã€‚");
            }
        }

        function generateRuleTables() {
            const container = document.getElementById('level-table-container');
            let html = '';
            html += `<div class="role-header">${gameData.mage.name}</div><table class="level-table"><tr><th>æ‰€éœ€XP</th><th>å¤´è¡”</th></tr>`;
            gameData.mage.levels.forEach(l => { html += `<tr><td>${l.xp}</td><td>${l.title}</td></tr>`; });
            html += '</table>';
            html += `<div class="role-header warrior">${gameData.warrior.name}</div><table class="level-table"><tr><th>æ‰€éœ€XP</th><th>å¤´è¡”</th></tr>`;
            gameData.warrior.levels.forEach(l => { html += `<tr><td>${l.xp}</td><td>${l.title}</td></tr>`; });
            html += '</table>';
            container.innerHTML = html;
        }
        function openRules() { document.getElementById('rules-modal').style.display = 'flex'; }
        function closeRules() { document.getElementById('rules-modal').style.display = 'none'; }

        init();
    </script>
</body>
</html>
